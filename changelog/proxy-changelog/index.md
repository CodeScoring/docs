- [English](https://docs.codescoring.ru/changelog/proxy-changelog.en/index.md)

# OSA Proxy Changelog

### [2026.5.2] - 2026-02-20

#### Добавлено

- Добавлена поддержка репозитория `https://download.pytorch.org`

### [2026.5.1] - 2026-02-11

#### Добавлено

- Реализовано проксирование `docker.io` через команду `docker pull` без префикса `library`

#### Изменено

- Заменена команда `KEYS` на `SCAN` для поиска ключей в Redis, чтобы Redis работал в режиме ограниченных привилегий (`+@all -@dangerous`)
- Расширено логирование анализа манифестов: теперь фиксируются заблокированные версии пакетов и применённые политики блокировки

#### Исправлено

- Отключена передача заголовков кеширования для HEAD-запросов, таким образом ускоряя обновление манифестов в JFrog Artifactory и применение политик

### [2026.5.0] - 2026-01-30

#### Добавлено

- Добавлены [метрики обращений](/osa-proxy/metrics.en/#codescoring-api-metrics) в CodeScoring
- Добавлена возможность подменять URL в ссылке на причину блокировки на указанный в конфиге `OSA-Proxy` `codescoring.host`. Подробнее в [документации](/osa-proxy/config)
- Добавлена поддержка [APK](/osa-proxy/config-apk) и [RPM](/osa-proxy/config-rpm) репозиториев
- Добавлена поддержка настройки `JAVA_OPTS` в Helm-чарте. Подробнее в [документации](/osa-proxy/installation)
- Добавлена поддержка [Docker-репозиториев](/osa-proxy/config-docker)

Особенности загрузки официальных образов

Загрузка официальных образов без префикса `library` (например, `docker pull <osa-proxy-host>/postgres`) будет добавлена в следующем патч-релизе. На данный момент необходимо использовать полный путь: `docker pull <osa-proxy-host>/library/postgres`

#### Изменено

- Изменены [метрики](/osa-proxy/metrics) `gateway_route_<package_type>_requests_seconds` с Histogram на SLO (10ms, 25ms, 50ms, 100ms, 250ms, 500ms, 1s, 2s, 5s)

#### Исправлено

- Исправлена работа с удаленными репозиториями за **Cloudflare**, приводившая к коду ошибки 1101 от Cloudflare
- Исправлена ошибка с добавлением репозитория к имени пакета в `PURL` для Go

#### Удалено

- Удалена дублирующая `gateway_route_` метрика `http_server_requests`

### [2025.52.2] - 2026-01-19

#### Исправлено

- Исправлено отображение пустых путей в дереве зависимостей, приводившее к некорректной работе в NuGet-cli. Если версии компонентов заблокированы, соответствующие им родительские узлы теперь также удаляются

### [2025.52.1] - 2026-01-15

#### Исправлено

- Исправлена ошибка проверки состояния (healthcheck) Redis в случае, если кэш отключён

### [2025.52.0] - 2025-12-23

#### Добавлено

- Добавлено кэширование результатов проверки политик в Redis с поддержкой TTL и фонового обновления. Подробнее в [документации](/osa-proxy/config-caching)
- Добавлен механизм проактивного обновления кэша по таймеру
- Добавлен Swagger UI для документации API (`/api/swagger`)
- Добавлен REST API для управления кэшем (`/api/cache`)
- Добавлено обновление заголовков (`Last-Modified`, `ETag`) для манифестов. Это решает проблему "устаревших" манифестов, с точки зрения политик.

#### Изменено

- Увеличено значение по умолчанию для переменной конфигурации `max-in-memory-size` с 50MB до 150MB (для обработки больших манифестов)
- Оптимизирована обработка манифестов NPM с использованием потокового процессора для повышения скорости обработки больших файлов и снижения нагрузки для сборщика мусора

### [2025.48.3] - 2025-12-08

#### Исправлено

- Устранена утечка ресурсов, которая проявлялась непосредственно перед циклом сборки мусора (GC)
- Исправлено поведение, приводившее к некорректному срабатыванию ошибки `Connection prematurely closed BEFORE response` в случаях, когда соединение было закрыто на стороне сервера или обратного прокси

### [2025.48.2] - 2025-12-02

#### Исправлено

- Исправлена ошибочная блокировка пакетов, имеющих дату публикации при активной политике `Дата публикации зависимости отсутствует`

### [2025.48.0] - 2025-11-28

#### Исправлено

- Исправлено применение политик безопасности для версий пакетов, данные о которых отсутствуют в CodeScoring Index на момент сканирования

### [2025.47.0] - 2025-11-19

#### Добавлено

- Реализована поддержка пакетов [Go](/osa-proxy/config-go) и [Debian](/osa-proxy/config-debian)
- Введена обработка статуса DELAYED
- Расширена функциональность прокси-сервера для передачи контекста через URL, что обеспечивает применение политик, привязанных к репозиториям, в конфигурации `jfrog/nexus -> OSA proxy -> internet`. Подробнее в [документации](/osa-proxy/base64-url).
- При запросе манифеста, в случае блокировки всех версий пакета, теперь отображается список соответствующих блокирующих политик

#### Исправлено

- Устранена ошибка, приводившая к неприменению политик для репозиториев в конфигурации `OSA proxy -> jfrog/nexus -> internet`

### [2025.39.2] - 2025-10-22

#### Добавлено

- Внедрены метрики для каждого типа пакетного менеджера, доступные по `gateway.route.[maven|npm|nuget|pipy].requests`
- При полной блокировке всех версий пакета в манифесте соответствующими политиками сервис теперь возвращает корректный статус ошибки и причину блокировки вместо пустого манифеста. На текущий момент только `nuget` корректно обрабатывает и отображает данную ошибку в консоли, остальные пакетные менеджеры сообщают, что подходящей версии не найдено
- Реализовано логирование предупреждений (`Warn`) в случае некорректной конфигурации, если манифест не содержит ссылок на пакеты, использующие URL из `repository.registry`. В редких случаях возможны ложно-положительные сообщения в логах, которые будут устранены в случае обнаружения

#### Исправлено

- Устранена ошибка, возникавшая при запросах JFrog Artifactory к актуальному индексу `pypi` пакетов по маршруту `/simple/`
- В режимах `warmup` & `spectator` блокировка версий в манифестах больше не производится

### [2025.39.1] - 2025-09-23

#### Сканирование пакетов

Два уровня сканирования:

- **Манифесты**: анализ и исключение заблокированных версий.
- **Пакеты**: анализ загружаемых файлов.

#### Блокировка небезопасных компонентов

- Заблокированные политиками версии исключаются из манифеста.
- Загрузка заблокированных политиками архивов блокируется.
- Возвращается настраиваемый код состояния с сообщением о блокировке в status-line.
