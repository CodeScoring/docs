stages:
  - lint

lint_trailing_spaces:
  stage: lint
  image: alpine:latest
  script:
  - echo "üîç Checking for trailing spaces in changed .md files..."
  - |
    if [ -n "$CI_MERGE_REQUEST_DIFF_BASE_SHA" ]; then
      BASE_REF="$CI_MERGE_REQUEST_DIFF_BASE_SHA"
    else
      git fetch origin main
      BASE_REF="origin/main"
    fi

    FILES=$(git diff --name-only "$BASE_REF"...HEAD -- '*.md')

    if [ -z "$FILES" ]; then
      echo "‚ÑπÔ∏è  No .md files changed. Skipping check."
      exit 0
    fi

    echo "üìÑ Changed .md files:"
    echo "$FILES"

    FOUND=false
    for file in $FILES; do
      if grep -n '[[:blank:]]$' "$file"; then
        FOUND=true
      fi
    done

    if [ "$FOUND" = true ]; then
      echo "‚ùå Trailing spaces found in .md files."
      exit 1
    else
      echo "‚úÖ No trailing spaces in changed files."
      exit 0
    fi