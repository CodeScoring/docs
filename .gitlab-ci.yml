stages:
  - lint

fix_trailing_spaces:
  stage: lint
  image: alpine:latest
  script:
    - echo "üßπ Removing trailing spaces in changed .md files..."

    - |
      if [ -n "$CI_MERGE_REQUEST_DIFF_BASE_SHA" ]; then
        BASE_REF="$CI_MERGE_REQUEST_DIFF_BASE_SHA"
      else
        git fetch origin main
        BASE_REF="origin/main"
      fi

      FILES=$(git diff --name-only "$BASE_REF"...HEAD -- '*.md')

      if [ -z "$FILES" ]; then
        echo "‚ÑπÔ∏è  No .md files changed. Skipping."
        exit 0
      fi

      echo "üìÑ Fixing files:"
      echo "$FILES"

      for file in $FILES; do
        sed -i 's/[[:blank:]]\+$//' "$file"
      done

      echo "üîç Checking if there are changes after cleanup..."
      if ! git diff --exit-code --quiet; then
        echo "‚ùå Found and fixed trailing spaces. Please commit the updated files:"
        git --no-pager diff
        exit 1
      else
        echo "‚úÖ No trailing spaces were found."
      fi
  only:
    - merge_requests
    - branches
