---
hide:
  - footer
---
# Работа с зависимостями в JavaScript

## NPM

### Создание файла `package-lock.json`

1. Инициализируйте проект:
   ```sh
   npm init -y
   ```
2. Установите зависимости:
   ```sh
   npm install
   ```

### Поддержка механизма NPM package alias

Механизм [NPM package alias](https://medium.com/@mahesh.jsdev/demystifying-npm-package-name-aliasing-a-comprehensive-guide-5a0a59519de9) позволяет устанавливать пакеты под разными именами, что удобно для одновременного использования нескольких версий библиотеки, замены зависимости без изменения её имени в коде и работы с форками. 

Вместо стандартного указания версии используется синтаксис, явно задающий, какой пакет и его версию установить под нужным именем. Это упрощает тестирование, обновления и совместимость зависимостей.  

Представим, что при сканировании зависимости **@babel/core** в транзитивных зависимостях отображается несуществующий пакет **@babel/legacy-core**. Однако в `package.json` у **@babel/core** указано:  

```json
"dependencies": {
  "@babel/legacy-core": "npm:@babel/core@=7.12.0",
  "tslib": "^2.4.0"
}
```

Консольный агент Johnny корректно обрабатывает эту запись, распознавая, что **@babel/legacy-core** – это alias для **@babel/core**. В ходе анализа зависимостей учитывается оригинальный пакет, предотвращая ошибки, связанные с несуществующими именами.

## Yarn

### Создание файла `yarn.lock`

1. Инициализируйте проект:
   ```sh
   yarn init -y
   ```
2. Установите зависимости:
   ```sh
   yarn install
   ```

### Поддержка механизма Yarn selective dependency resolution

Yarn поддерживает [избирательное разрешение версий](https://classic.yarnpkg.com/lang/en/docs/selective-version-resolutions/) через поле `resolutions` в `package.json`, что позволяет задавать конкретные версии зависимостей без редактирования `yarn.lock`. 

Этот механизм полезеен, если вам нужно обновить подзависимость, которая не обновляется часто, исправить уязвимость в подзависимости или зафиксировать версию из-за проблемного обновления.

CodeScoring поддерживает обработку данного механизма в консольном агенте Johnny. Вот несколько сценариев его работы:

#### Замена пакета

Для замены пакета через механизм resolutions, в `package.json` добавляется следующая запись. В данном примере пакет **parcel/watcher** заменяется на пакет **favware/skip-dependency**.

```json
"resolutions": {
  "@parcel/watcher": "npm:@favware/skip-dependency@latest"
}
```

Соответствующие данному пакету записи в файле `yarn.lock `будут следующими:

```yaml
dependencies:
  "@parcel/watcher": "npm:2.1.0"
```

При установке в сборке используется пакет **favware/skip-dependency** версии 1.2.2. Консольный агент корректно идентифицирует данный механизм и анализирует именно финальный пакет.

```yaml
"@parcel/watcher@npm:@favware/skip-dependency@latest":
  version: 1.2.2
  resolution: "@favware/skip-dependency@npm:1.2.2"
```

#### Фиксация версии

Для фиксации версии через механизм resolutions в `package.json` добавляется следующая запись. В данном примере версия пакета **http-signature** фиксируется на **1.3.4**.

```json
"resolutions": {
  "http-signature": "1.3.4"
}
```

Соответствующие данному пакету записи в файле `yarn.lock` будут следующими:

```yaml
dependencies:
  http-signature "~1.2.0"
```

При установке в сборке будет использована версия **http-signature 1.3.4**. Консольный агент анализирует финальную версию пакета.

```yaml
http-signature@1.3.4, http-signature@~1.2.0:
  version "1.3.4"
  resolved "https://registry.yarnpkg.com/http-signature/-/http-signature-1.3.4.tgz#a65b41193110b222364e776fd1ac848655a0e2f0"
```

#### Фиксация версии при множественных зависимостях  

Для фиксации версии при наличии нескольких зависимостей через механизм resolutions в `package.json` добавляется следующая запись. В данном примере версия пакета **yaml** фиксируется на **2.2.2**.

```json
"resolutions": {
  "yaml": "2.2.2"
}
```

Соответствующие данному пакету записи в файле `yarn.lock` будут следующими:

```yaml
dependencies:
  yaml: ^1.10.0
  yaml: ^2.2.1
  yaml: ^1.7.2
  yaml: ^1.10.2
  yaml: ^2.3.4
  yaml: 2.3.1
  yaml: ^2.1.1
```

При установке в сборке будет использована версия **2.2.2**. Консольный агент анализирует только зафиксированную в `resolutions` версию пакета.

```yaml
"yaml@npm:2.2.2":
  version: 2.2.2
  resolution: "yaml@npm:2.2.2"
```