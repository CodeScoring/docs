---
hide:
  - footer
---

# Сканирование сборки для языков C и C++

В случае, если для сборки C/С++ проекта не используется пакетный менеджер Conan и соответствующие манифесты, для получения списка используемых библиотек Johnny можно запустить в специальном режиме для анализа вывода процесса сборки.

Johnny анализирует процесс сборки, используя флаги компилятора и выявляя использованные библиотеки. Далее с помощью системного кэша определяется местоположение библиотек и их источник.

Версия используемой библиотеки может быть найдена, если библиотека была подключена статически. В таком случае агент анализирует `.pc` файл, содержащий метаданные о компоненте.

## Пример работы

В проект добавляется JSON-файл `buildConfig`, описывающий последовательность команд для сборки. Например:

```json
{
 //  Commands for execution
 "commands": [
    {
   // Command
   "command": "make",
   // Command execute parameters
   "flags_and_args": "clean"
  },
  {
   "command": "./configure"
  },
  {
   "command": "make",
   // analyze this command
   "do_analyze": true
  }
 ]
}
```

Далее вызывается команда анализа сборки и указывается путь до конфиг-файла:

```shell
./johnny scan build ./buildConfig.json
```

В результате работы агент отображает один из кодов:

- **0** – успешный анализ, не было выявлено проблем в сборке;
- **1** – в результате сканирования найдены проблемы, соответствующие настроенным [политикам безопасности](//on-premise/how-to/policies/), необходимо действие пользователя;
- **2** – анализ не удался;
- **3** – пустой результат, не были найдены артефакты для анализа. Возвращается только если параметр `--block-on-empty-result` имеет значение `true`.

**Важно**: на данный момент команда поддерживает только Debian-based и RPM-based дистрибутивы Linux.

## Параметры команды

Команда **scan build** имеет шесть уникальных параметров, помимо [общих настроек команды сканирования](/agent/scan/#_2):

- `--build-result` – вводные данные представляют собой результат предыдущего процесса сборки, включая скомпилированные артефакты;
- `--lib-versions` – путь к JSON-файлу со списком версий анализируемых библиотек;
- `--output` – путь к файлу, в котором будут сохранены результаты сканирования;
- `--unresolved-file` – путь к файлу, где будут сохранены сведения о библиотеках с неразрешенными версиями.
- `--branch-or-tag`  – ссылка на ветку или тег репозитория в формате `^refs/(heads|tags)/.+` (например, `refs/tags/v1.0`);
- `--commit` – указание хэша коммита.

Для сводки доступных параметров команды и инструкции по использованию можно вызвать команду с флагом `-h, --help`.

## Сканирование с использованием eBPF

**eBPF** (extended Berkeley Packet Filter) – это технология в ядре Linux, которая позволяет безопасно запускать пользовательский код в ответ на события в системе, такие как сетевой трафик, системные вызовы или действия процессов.

Особенность команды `scan build ebpf` состоит в том, что анализ выполняется не по протоколу сборочного инструмента, а путем мониторинга запускаемых процессов и их параметров через механизм eBPF.

**Важно**: для обеспечения работы с механизмом eBPF, запуск команды должен выполняться с правами **root-пользователя**.

### Пример работы

Параметры и результаты работы команды аналогичны команде `scan build`.

```shell
./johnny scan build ebpf ./buildConfig.json
```
