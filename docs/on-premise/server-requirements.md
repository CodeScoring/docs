# Требования к серверу

## Ресурсы сервера

Для установки on-premise версии рекомендуется использовать сервер с **Linux Ubuntu 20.04**, именно на этой системе мы проводим тестирование и отладку. Несмотря на использование Docker, особенности его работы в разных операционных системах может приводить к неожиданным затруднениям.

**Рекомендация по ресурсам: 16Gb RAM, 8 ядер CPU.**   
Дополнительно стоит убедиться, что раздел, на котором размещается директория с данными docker (data-root docker, по умолчанию `/var`), должен быть **не менее 20Gb** при этом для бесперебойного функционирования системы необходимо **резервировать дисковое пространство из расчета размера анализируемых репозиториев, умноженного на три**.

Для установки системы должен быть доступен публичный [Docker Hub](https://hub.docker.com/), а также Docker Registry с образами CodeScoring, адрес которого будет предоставлен вместе с ключом активации.

## Внешние запросы

Для корректной работы с сервера должны быть доступны адреса Index API системы с постоянно актуализируемой базой известных пакетов и их атрибутов. Адреса указаны в конфигурации по умолчанию.

Из облачного Index API инсталляция получает обогащенную информацию по найденным зависимостям, их лицензиям и уязвимостями.

Общая архитектура работы представлена на изображении ниже.

![CodeScoring on-premise architecture](/assets/img/on-premise-architechture.png)

Из инсталляции в облако CodeScoring не отправляется исходный код, но для получения информации по зависимостям отправляется:

1. анонимизированная информация по найденным манифестам пакетных менеджеров и их содержимому
2. хэши файлов исходного кода для поиска прямых включений open source библиотек в код проектов

Пути манифестов и названия файлов специально анонимизируются.

Пример содержимого запроса от инсталляции к Indes API с данными по манифестам пакетных менеджеров:


```
[
  {
    "path": "string",
    "type": "string",
    "name": "string",
    "extension": "string",
    "result": {
      "platform": "cocoapods",
      "dependencies": [
        {
          "name": "",
          "requirement": "string",
          "resolved_requirement": "",
          "env": "runtime",
          "is_transitive": false,
          "is_git": false
        }
      ],
      "related": [
        "string"
      ],
      "extra": {},
      "success": true,
      "kind": "lockfile"
    },
    "fake": false
  },
  {
    "path": "string",
    "type": "string",
    "name": "string",
    "extension": "string",
    "result": {
      "platform": "cocoapods",
      "dependencies": [
        {
          "name": "",
          "requirement": "string",
          "resolved_requirement": "",
          "env": "runtime",
          "is_transitive": false,
          "is_git": false
        }
      ],
      "related": [
        "string"
      ],
      "extra": {},
      "success": true,
      "kind": "manifest"
    }
  }
]
```

Пример содержимого запроса от инсталляции к Index API с данными по хэшам файлов исходного кода:


```
[
  {
    "id": "string",
    "ext": "string",
    "sha256": "string"
  }
]
```

