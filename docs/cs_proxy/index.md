---
hide:
  - footer
---

# Общее описание

**CodeScoring Proxy** (repo-manager-proxy) — это прокси-сервис, выступающий посредником между пакетными менеджерами и их удалёнными репозиториями. Он интегрируется с платформой CodeScoring и обеспечивает автоматическое сканирование загружаемых компонентов и блокировку небезопасных пакетов в соответствии с политиками безопасности.

Сервис перехватывает запросы, выполняемые пакетными менеджерами, отправляет их на исходные репозитории, анализирует полученные пакеты, модифицирует ответы и управляет доступом к компонентам. Используется асинхронная модель обработки, кэширование результатов и механизм автоматических повторов при временных ошибках. Также поддерживается работа с большими файлами с возможностью настройки размера буфера.

## Поддерживаемые пакетные менеджеры

CodeScoring Proxy обрабатывает запросы к следующим репозиториям:

- Maven Central (`https://repo1.maven.org`)
- NPM Registry (`https://registry.npmjs.org`)
- PyPI (`https://pypi.org`)
- NuGet Gallery (`https://api.nuget.org`)
- Docker Hub (`https://hub.docker.com/v2/`)

**Важно**: поддерживаются также альтернативные репозитории, реализующие официальные спецификации соответствующего пакетного менеджера (например Nexus Repository и JFrog Artifactory).

## Основные возможности

### Сканирование пакетов

Для каждой экосистемы реализованы два уровня сканирования:

- **Сканирование манифестов** — проверка метаданных пакета (имя, версия, зависимости, лицензии, дата публикации);
- **Сканирование пакетов** — загрузка и анализ самих файлов пакета или образа, включая вложенные файлы и зависимости.

### Блокировка небезопасных компонентов

Если компонент нарушает правила политики безопасности:

- небезопасные версии исключаются из списка доступных в манифесте;
- скачивание соответствующих архивов блокируется;
- возвращается настраиваемый код состояния с сообщением о причине блокировки.

### Модификация ответов

CodeScoring Proxy автоматически модифицирует ответы от оригинальных репозиториев:

- перенаправляет все URL;
- удаляет заблокированные версии из метаданных;
- пересчитывает контрольные суммы изменённых манифестов, чтобы сохранить корректность формата.

## Режимы работы

Поведение сервиса регулируется параметром `work-mode`. В зависимости от выбранного значения меняется логика обработки сканирования, ожидания и блокировки. Поддерживаются следующие режимы:

- `strict_wait` — ожидает завершения сканирования и блокирует компонент при любом нарушении политики;
- другие режимы влияют на поведение при таймаутах и ошибках сканирования.

## Обработка ошибок

Сервис возвращает детализированные коды ошибок при отклонении запроса:

- `blocked_by_policies` — компонент заблокирован политиками CodeScoring;
- `blocked_not_scanned` — компонент ещё не прошёл сканирование;
- `failed_request` — ошибка при обращении к инсталляции CodeScoring;
- `blocked_scan_failed` — ошибка при выполнении сканирования;
- `blocked_scan_wait_timeout` — превышено время ожидания сканирования;
- `blocked_registry_not_configured` — репозиторий не зарегистрирован на инсталляции CodeScoring.
