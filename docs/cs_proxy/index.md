# CodeScoring Proxy

CodeScoring Proxy (repo-manager-proxy) - это прокси-сервис, который выступает промежуточным звеном между пакетными менеджерами и их репозиториями. Сервис интегрируется с платформой CodeScoring для сканирования и блокировки небезопасных пакетов.

## Поддерживаемые пакетные менеджеры

Сервис проксирует запросы к следующим репозиториям:

* Maven Central (`https://repo1.maven.org`)
* NPM Registry (`https://registry.npmjs.org`)
* PyPI (`https://pypi.org`)
* NuGet Gallery (`https://api.nuget.org`)
* Docker (`https://hub.docker.com/v2/`)

!!! note "Поддержка альтернативных репозиториев"
    Поддерживаются также репозитории, реализующие официальную спецификацию соответствующего пакетного менеджера (например, Nexus, JFrog).

## Основные возможности

### Сканирование пакетов

Для каждого пакетного менеджера реализовано два типа сканирования:

* **Сканирование манифестов** - проверка метаданных пакетов
* **Сканирование пакетов** - проверка самих файлов пакетов

### Блокировка небезопасных пакетов

При обнаружении проблем с безопасностью сервис:

* Удаляет небезопасные версии из списков доступных версий в манифестах
* Блокирует скачивание файлов небезопасных пакетов
* Возвращает настраиваемый код состояния с описанием причины блокировки

### Модификация ответов

Сервис автоматически модифицирует ответы от оригинальных репозиториев:

* Перенаправляет URL через прокси
* Удаляет заблокированные версии из метаданных
* Обновляет контрольные суммы для измененных манифестов

## Режимы работы

Сервис поддерживает различные режимы работы через параметр `work-mode`:

* `strict_wait` - ожидает завершения сканирования, блокирует при любых проблемах
* Другие режимы влияют на поведение при таймаутах и ошибках сканирования

## Обработка ошибок

Сервис предоставляет детализированные сообщения об ошибках:

* `blocked_by_policies` - заблокировано политиками CodeScoring
* `blocked_not_scanned` - компонент еще не отсканирован
* `failed_request` - ошибка при запросе к CodeScoring
* `blocked_scan_failed` - ошибка сканирования
* `blocked_scan_wait_timeout` - таймаут ожидания сканирования
* `blocked_registry_not_configured` - репозиторий не настроен в CodeScoring

## Особенности реализации

1. **Кэширование**: Результаты сканирования кэшируются для уменьшения нагрузки на CodeScoring API
2. **Асинхронная обработка**: Использование реактивного подхода
3. **Retry механизм**: Автоматические повторы при временных сбоях
4. **Поддержка больших файлов**: Настраиваемый размер буфера для обработки больших пакетов
